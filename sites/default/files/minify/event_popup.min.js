(function($){Drupal.behaviors.event_popup={attach:function(context,settings){if($("#event-popup-container").length==0){$("body").append('<div id="event-popup-container" style="display:none;"></div>');try{$("#event-popup-container").dialog({autoOpen:false,modal:true,close:function(event,ui){$("#event-popup-container").html("")}});var defaultOptions=Drupal.event_popup.explodeOptions(settings.event_popup.defaults);$("#event-popup-container").dialog("option",defaultOptions)}catch(err){Drupal.event_popup.log("[error] Event Dialog: "+
err)}}var classes="";if(settings.event_popup.classes)classes=", ."+settings.event_popup.classes;$("a.event-popup"+classes,context).each(function(event){if(!event.metaKey&&!$(this).hasClass("simpleEventProcessed")){$(this).addClass("simpleEventProcessed");$(this).click(function(event){event.preventDefault();var url=$(this).attr("href");var title=$(this).attr("title");var selector=$(this).attr("name")?"event-calendar":"event_calendar";var options=Drupal.event_popup.explodeOptions("width:auto;height:auto;position:[300,140]");
if(url&&title&&selector){$("#event-popup-container").dialog("option",options);$("#event-popup-container").dialog("option","title",title);$("#event-popup-container").html('<div class="event-popup-ajax-loader"></div>');if(options.height&&options.height=="auto")$("#event-popup-container").dialog("option","height",200);$.get(url,function(data){if(options.height&&options.height=="auto")$("#event-popup-container").dialog("option","height",options.height);$("#event-popup-container").html($("<div></div>").html(data).find(":regex(class, .*"+
selector+".*)").not(".field").clone())});$("#event-popup-container").dialog("open");return false}})}});var op=Drupal.settings.event_popup.op;if(op)$("table.full tr td, table.mini tr td",context).click(function(){var node_type=Drupal.settings.event_popup.content_type;node_type=node_type.replace("_","-");var url=Drupal.settings.basePath+"node/add/"+node_type;var title="Create Event";var selector=Drupal.settings.event_popup.selector;var options=Drupal.event_popup.explodeOptions("width:auto;height:auto;position:[300,140]");
if(url&&title&&selector){var event_date=$(this).attr("data-date");$("#event-popup-container").dialog("option",options);$("#event-popup-container").dialog("option","title",title);$("#event-popup-container").html('<div class="event-popup-ajax-loader"></div>');if(options.height&&options.height=="auto")$("#event-popup-container").dialog("option","height",200);$.get(url,{"date":event_date},function(data){if(options.height&&options.height=="auto")$("#event-popup-container").dialog("option","height",options.height);
$("#event-popup-container").html($("<div></div>").html(data).find("#"+selector).clone())});$("#event-popup-container").dialog("open");return false}})}};Drupal.event_popup={};Drupal.event_popup.explodeOptions=function(opts){var options=opts.split(";");var explodedOptions={};for(var i in options)if(options[i]){var option=Drupal.event_popup.cleanOption(options[i].split(":"));explodedOptions[option[0]]=option[1]}return explodedOptions};Drupal.event_popup.cleanOption=function(option){if(option[0]=="position"&&
option[1].match(/\[.*,.*\]/)){option[1]=option[1].match(/\[(.*)\]/)[1].split(",");if(!isNaN(parseInt(option[1][0])))option[1][0]=parseInt(option[1][0]);if(!isNaN(parseInt(option[1][1])))option[1][1]=parseInt(option[1][1])}if(option[1]==="true")option[1]=true;else if(option[1]==="false")option[1]=false;return option};Drupal.event_popup.log=function(msg){if(window.console)window.console.log(msg)}})(jQuery);